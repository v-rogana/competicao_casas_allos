<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Arena das Casas ‚Äî Allos</title>
    <meta name="description" content="Competi√ß√£o cl√≠nica entre as Casas da Associa√ß√£o Allos" />
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚öîÔ∏è</text></svg>" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;0,700;1,400&family=Outfit:wght@300;400;500;600&display=swap" rel="stylesheet" />
    <style>
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
        
        :root {
            --prisma: #2B7A9E;
            --prisma-light: #3AAFCF;
            --prisma-dark: #1A5276;
            --macondo: #6C4F9E;
            --macondo-light: #9B7FD0;
            --macondo-dark: #4A3072;
            --marmoris: #D4A574;
            --marmoris-light: #E8CBA8;
            --marmoris-dark: #C4956A;
            --allos: #2E9E8F;
            --allos-light: #5EEAD4;
            --bg: #07070C;
            --text: #E8E6E3;
        }
        
        body {
            min-height: 100vh;
            background: var(--bg);
            color: var(--text);
            font-family: 'Cormorant Garamond', Georgia, serif;
            overflow-x: hidden;
        }
        
        .body-font {
            font-family: 'Outfit', -apple-system, sans-serif;
        }
        
        /* ‚îÄ‚îÄ Animations ‚îÄ‚îÄ */
        @keyframes floatParticle {
            0%, 100% { transform: translate(0, 0) scale(1); opacity: var(--p-opacity); }
            25% { transform: translate(10px, -20px) scale(1.3); }
            50% { transform: translate(-5px, -40px) scale(0.8); }
            75% { transform: translate(15px, -20px) scale(1.1); }
        }
        
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes shimmer {
            0% { background-position: -200% center; }
            100% { background-position: 200% center; }
        }
        
        @keyframes pulseGlow {
            0%, 100% { opacity: 0.4; }
            50% { opacity: 0.9; }
        }
        
        @keyframes crownBounce {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-3px) scale(1.1); }
        }
        
        @keyframes barGrow {
            from { width: 0%; }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* ‚îÄ‚îÄ Particles ‚îÄ‚îÄ */
        .particles {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 0;
            overflow: hidden;
        }
        
        .particle {
            position: absolute;
            border-radius: 50%;
            background: var(--allos);
            animation: floatParticle var(--p-dur) ease-in-out var(--p-delay) infinite;
            opacity: var(--p-opacity);
        }
        
        /* ‚îÄ‚îÄ Background Orbs ‚îÄ‚îÄ */
        .bg-orb {
            position: fixed;
            border-radius: 50%;
            pointer-events: none;
            z-index: 0;
        }
        
        .bg-orb-1 {
            top: -20%; left: -10%;
            width: 50%; height: 50%;
            background: radial-gradient(circle, rgba(46,158,143,0.06), transparent 70%);
        }
        
        .bg-orb-2 {
            bottom: -20%; right: -10%;
            width: 60%; height: 60%;
            background: radial-gradient(circle, rgba(108,79,158,0.04), transparent 70%);
        }
        
        /* ‚îÄ‚îÄ Layout ‚îÄ‚îÄ */
        .container {
            position: relative;
            z-index: 1;
            max-width: 1100px;
            margin: 0 auto;
            padding: 40px 24px 80px;
        }
        
        /* ‚îÄ‚îÄ Header ‚îÄ‚îÄ */
        .header {
            text-align: center;
            margin-bottom: 48px;
            animation: fadeInUp 0.8s cubic-bezier(0.22, 1, 0.36, 1) both;
        }
        
        .badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 18px;
            border-radius: 100px;
            border: 1px solid rgba(46,158,143,0.25);
            background: rgba(46,158,143,0.06);
            font-size: 12px;
            font-weight: 500;
            letter-spacing: 1.5px;
            text-transform: uppercase;
            color: var(--allos-light);
            margin-bottom: 24px;
        }
        
        .badge-dot {
            width: 6px; height: 6px;
            border-radius: 50%;
            background: var(--allos-light);
            animation: pulseGlow 2s infinite;
        }
        
        .main-title {
            font-size: clamp(36px, 6vw, 60px);
            font-weight: 300;
            letter-spacing: -0.02em;
            line-height: 1.1;
            margin-bottom: 12px;
        }
        
        .main-title em {
            font-weight: 600;
            font-style: italic;
            background: linear-gradient(135deg, var(--prisma), var(--allos), var(--marmoris), var(--macondo));
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: shimmer 6s linear infinite;
        }
        
        .subtitle {
            font-size: 15px;
            color: rgba(255,255,255,0.4);
            font-weight: 300;
            letter-spacing: 0.3px;
        }
        
        /* ‚îÄ‚îÄ Period Toggle ‚îÄ‚îÄ */
        .period-toggle {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-bottom: 48px;
            animation: fadeInUp 0.8s cubic-bezier(0.22, 1, 0.36, 1) 0.1s both;
        }
        
        .period-btn {
            padding: 10px 28px;
            border: 1px solid rgba(255,255,255,0.12);
            background: rgba(255,255,255,0.03);
            color: rgba(255,255,255,0.5);
            border-radius: 100px;
            cursor: pointer;
            font-family: 'Outfit', sans-serif;
            font-size: 14px;
            font-weight: 500;
            letter-spacing: 0.5px;
            transition: all 0.4s cubic-bezier(0.22, 1, 0.36, 1);
            backdrop-filter: blur(10px);
        }
        
        .period-btn:hover {
            background: rgba(255,255,255,0.06);
            border-color: rgba(255,255,255,0.2);
        }
        
        .period-btn.active {
            background: rgba(46,158,143,0.15);
            border-color: rgba(46,158,143,0.5);
            color: var(--allos-light);
            box-shadow: 0 0 20px rgba(46,158,143,0.15);
        }
        
        /* ‚îÄ‚îÄ House Cards ‚îÄ‚îÄ */
        .houses-grid {
            display: flex;
            gap: 20px;
            margin-bottom: 48px;
            animation: fadeInUp 0.8s cubic-bezier(0.22, 1, 0.36, 1) 0.2s both;
        }
        
        .house-card {
            flex: 1;
            background: rgba(255,255,255,0.02);
            border: 1px solid rgba(255,255,255,0.06);
            border-radius: 20px;
            padding: 28px 24px;
            text-align: center;
            transition: all 0.5s cubic-bezier(0.22, 1, 0.36, 1);
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(20px);
        }
        
        .house-card::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 20px;
            padding: 1px;
            background: var(--card-gradient);
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            opacity: 0;
            transition: opacity 0.5s;
        }
        
        .house-card:hover::before { opacity: 0.5; }
        
        .house-card:hover {
            transform: translateY(-4px);
            background: rgba(255,255,255,0.04);
            box-shadow: 0 20px 60px var(--card-glow);
        }
        
        .house-card .glow-bg {
            position: absolute;
            top: -50%; left: 50%;
            transform: translateX(-50%);
            width: 80%; height: 80%;
            border-radius: 50%;
            pointer-events: none;
            opacity: 0.5;
        }
        
        .house-card .inner { position: relative; }
        
        .house-emblem {
            width: 56px; height: 56px;
            margin: 0 auto 16px;
        }
        
        .house-name {
            font-size: 28px;
            font-weight: 600;
            font-style: italic;
            margin-bottom: 4px;
            letter-spacing: -0.01em;
        }
        
        .house-sensibility {
            font-size: 12px;
            color: rgba(255,255,255,0.35);
            font-weight: 400;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            margin-bottom: 12px;
        }
        
        .house-motto {
            font-size: 14px;
            font-style: italic;
            color: rgba(255,255,255,0.25);
            margin-bottom: 20px;
            font-weight: 300;
        }
        
        .house-stats {
            display: flex;
            justify-content: center;
            gap: 24px;
        }
        
        .house-stat-value {
            font-size: 22px;
            font-weight: 600;
        }
        
        .house-stat-label {
            font-size: 11px;
            color: rgba(255,255,255,0.3);
            font-weight: 400;
        }
        
        .house-stats-divider {
            width: 1px;
            background: rgba(255,255,255,0.08);
        }
        
        .house-leader {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid rgba(255,255,255,0.05);
            font-size: 13px;
            color: rgba(255,255,255,0.4);
            font-weight: 400;
        }
        
        .house-leader span {
            font-weight: 500;
        }
        
        /* ‚îÄ‚îÄ KPI Sections ‚îÄ‚îÄ */
        .kpi-list {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }
        
        .kpi-section {
            background: rgba(255,255,255,0.015);
            border: 1px solid rgba(255,255,255,0.05);
            border-radius: 20px;
            padding: 32px;
            position: relative;
            overflow: hidden;
        }
        
        .kpi-section::after {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(46,158,143,0.3), transparent);
        }
        
        .kpi-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            margin-bottom: 28px;
            flex-wrap: wrap;
            gap: 12px;
        }
        
        .kpi-title-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 4px;
        }
        
        .kpi-icon { font-size: 20px; }
        
        .kpi-title {
            font-size: 24px;
            font-weight: 600;
            letter-spacing: -0.01em;
        }
        
        .kpi-subtitle {
            font-size: 13px;
            color: rgba(255,255,255,0.35);
            font-weight: 300;
            cursor: help;
            position: relative;
        }
        
        .kpi-subtitle .tooltip {
            visibility: hidden;
            opacity: 0;
            position: absolute;
            bottom: 130%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(20,20,30,0.95);
            border: 1px solid rgba(255,255,255,0.1);
            color: rgba(255,255,255,0.8);
            padding: 8px 14px;
            border-radius: 10px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 10;
            transition: all 0.2s;
            backdrop-filter: blur(10px);
        }
        
        .kpi-subtitle:hover .tooltip {
            visibility: visible;
            opacity: 1;
        }
        
        /* ‚îÄ‚îÄ KPI Bars ‚îÄ‚îÄ */
        .kpi-bars {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .bar-row-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        
        .bar-label {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .bar-dot {
            width: 10px; height: 10px;
            border-radius: 50%;
        }
        
        .bar-name {
            font-size: 14px;
            font-weight: 500;
        }
        
        .best-tag {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 2px 10px;
            border-radius: 100px;
            font-size: 11px;
            font-weight: 600;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            animation: crownBounce 2s ease-in-out infinite;
        }
        
        .bar-value {
            font-size: 18px;
            font-weight: 600;
            font-family: 'Outfit', sans-serif;
        }
        
        .bar-track {
            width: 100%;
            height: 28px;
            border-radius: 14px;
            background: rgba(255,255,255,0.04);
            overflow: hidden;
            position: relative;
            border: 1px solid rgba(255,255,255,0.06);
        }
        
        .bar-fill {
            height: 100%;
            border-radius: 14px;
            position: relative;
            transition: width 1.2s cubic-bezier(0.22, 1, 0.36, 1);
            width: 0%;
        }
        
        .bar-fill .shine {
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 50%;
            background: linear-gradient(180deg, rgba(255,255,255,0.15), transparent);
            border-radius: 14px 14px 0 0;
        }
        
        /* ‚îÄ‚îÄ Footer ‚îÄ‚îÄ */
        .footer {
            margin-top: 64px;
            padding-top: 32px;
            border-top: 1px solid rgba(255,255,255,0.06);
            text-align: center;
            font-size: 12px;
            color: rgba(255,255,255,0.2);
            font-weight: 300;
            line-height: 1.8;
            animation: fadeIn 1s 1.2s both;
        }
        
        .footer .allos-slogan { color: rgba(46,158,143,0.5); }
        
        /* ‚îÄ‚îÄ Loading ‚îÄ‚îÄ */
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 60vh;
            gap: 24px;
            animation: fadeIn 0.5s both;
        }
        
        .loading-spinner {
            width: 48px; height: 48px;
            border: 2px solid rgba(255,255,255,0.06);
            border-top-color: var(--allos-light);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        
        @keyframes spin { to { transform: rotate(360deg); } }
        
        .loading-text {
            font-size: 14px;
            color: rgba(255,255,255,0.3);
        }
        
        /* ‚îÄ‚îÄ Error ‚îÄ‚îÄ */
        .error-box {
            text-align: center;
            padding: 48px;
            background: rgba(255,80,80,0.05);
            border: 1px solid rgba(255,80,80,0.15);
            border-radius: 20px;
            margin-top: 48px;
        }
        
        .error-box h2 {
            color: #ff6b6b;
            margin-bottom: 12px;
        }
        
        .error-box p {
            color: rgba(255,255,255,0.4);
            font-size: 14px;
        }
        
        /* ‚îÄ‚îÄ Responsive ‚îÄ‚îÄ */
        @media (max-width: 768px) {
            .houses-grid { flex-direction: column; }
            .kpi-section { padding: 20px; }
            .container { padding: 24px 16px 60px; }
            .period-toggle { flex-direction: column; align-items: center; }
        }
    </style>
</head>
<body>
    <!-- Background -->
    <div class="particles" id="particles"></div>
    <div class="bg-orb bg-orb-1"></div>
    <div class="bg-orb bg-orb-2"></div>

    <div class="container" id="app">
        <!-- Header -->
        <header class="header">
            <div class="badge body-font">
                <span class="badge-dot"></span>
                Associa√ß√£o Allos
            </div>
            <h1 class="main-title">Arena das <em>Casas</em></h1>
            <p class="subtitle body-font">Competi√ß√£o cl√≠nica entre as Casas da Allos</p>
        </header>

        <!-- Loading State -->
        <div class="loading" id="loading">
            <div class="loading-spinner"></div>
            <p class="loading-text body-font">Carregando dados das Casas...</p>
        </div>

        <!-- Content (hidden until data loads) -->
        <div id="content" style="display:none;">
            <!-- Period Toggle -->
            <div class="period-toggle" id="periodToggle"></div>

            <!-- House Cards -->
            <div class="houses-grid" id="housesGrid"></div>

            <!-- KPI Sections -->
            <div class="kpi-list" id="kpiList"></div>

            <!-- Footer -->
            <footer class="footer body-font" id="footer"></footer>
        </div>
    </div>

    <script>
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // Arena das Casas ‚Äî Vanilla JS Dashboard
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

    const HOUSES = {
        prisma: {
            color: '#2B7A9E', colorLight: '#3AAFCF', colorDark: '#1A5276',
            gradient: 'linear-gradient(135deg, #1A5276, #2B7A9E, #3AAFCF)',
            glow: 'rgba(43,122,158,0.4)',
        },
        macondo: {
            color: '#6C4F9E', colorLight: '#9B7FD0', colorDark: '#4A3072',
            gradient: 'linear-gradient(135deg, #4A3072, #6C4F9E, #9B7FD0)',
            glow: 'rgba(108,79,158,0.4)',
        },
        marmoris: {
            color: '#D4A574', colorLight: '#E8CBA8', colorDark: '#C4956A',
            gradient: 'linear-gradient(135deg, #C4956A, #D4A574, #E8CBA8)',
            glow: 'rgba(212,165,116,0.4)',
        },
    };

    const HOUSE_ORDER = ['prisma', 'macondo', 'marmoris'];

    const KPI_CONFIG = [
        { key: 'adimplencia', label: 'Adimpl√™ncia', subtitle: 'Pagamentos / Pacientes Ativos', unit: '%', maxValue: 100, icon: 'üí∞', desc: 'Taxa de pacientes com pagamento registrado no per√≠odo' },
        { key: 'sessoes_paciente', label: 'Sess√µes por Paciente', subtitle: 'M√©dia de sess√µes realizadas', unit: '', maxValue: null, icon: 'üìã', desc: 'N√∫mero m√©dio de sess√µes realizadas por paciente ativo' },
        { key: 'qualidade', label: 'Qualidade da Terapia', subtitle: 'M√©dia das avalia√ß√µes (0-10)', unit: '/10', maxValue: 10, icon: '‚≠ê', desc: 'Nota m√©dia de qualidade geral atribu√≠da pelos pacientes' },
        { key: 'comparecimento', label: 'Taxa de Comparecimento', subtitle: 'Sess√µes realizadas / Total agendado', unit: '%', maxValue: 100, icon: '‚úÖ', desc: 'Percentual de sess√µes efetivamente realizadas' },
        { key: 'evolucao_ors', label: 'Evolu√ß√£o Cl√≠nica', subtitle: 'Œî ORS (Sa√≠da ‚àí Entrada)', unit: ' pts', maxValue: null, icon: 'üìà', desc: 'Melhora m√©dia na pontua√ß√£o ORS entre entrada e sa√≠da' },
    ];

    // ‚îÄ‚îÄ State ‚îÄ‚îÄ
    let appData = null;
    let currentPeriod = 'current';

    // ‚îÄ‚îÄ Particles ‚îÄ‚îÄ
    function createParticles() {
        const container = document.getElementById('particles');
        for (let i = 0; i < 25; i++) {
            const p = document.createElement('div');
            p.className = 'particle';
            const size = Math.random() * 2 + 1;
            p.style.cssText = `
                left:${Math.random()*100}%;top:${Math.random()*100}%;
                width:${size}px;height:${size}px;
                --p-dur:${Math.random()*20+15}s;
                --p-delay:${Math.random()*-20}s;
                --p-opacity:${Math.random()*0.3+0.1};
            `;
            container.appendChild(p);
        }
    }

    // ‚îÄ‚îÄ House Emblem SVG ‚îÄ‚îÄ
    function houseEmblem(house, size = 56) {
        const c = HOUSES[house];
        const m = size / 2;
        let shape = '';

        if (house === 'prisma') {
            shape = `
                <polygon points="${m},${size*0.2} ${size*0.75},${size*0.7} ${size*0.25},${size*0.7}" fill="none" stroke="${c.colorLight}" stroke-width="2">
                    <animateTransform attributeName="transform" type="rotate" from="0 ${m} ${m}" to="360 ${m} ${m}" dur="20s" repeatCount="indefinite"/>
                </polygon>
                <polygon points="${m},${size*0.28} ${size*0.68},${size*0.64} ${size*0.32},${size*0.64}" fill="url(#fill-${house})" opacity="0.7"/>
            `;
        } else if (house === 'macondo') {
            shape = `
                <rect x="${size*0.25}" y="${size*0.25}" width="${size*0.5}" height="${size*0.5}" rx="4" fill="url(#fill-${house})" opacity="0.7"/>
                <line x1="${m}" y1="${size*0.25}" x2="${m}" y2="${size*0.75}" stroke="${c.colorDark}" stroke-width="1.5"/>
                <line x1="${size*0.25}" y1="${m}" x2="${size*0.75}" y2="${m}" stroke="${c.colorDark}" stroke-width="1.5"/>
            `;
        } else {
            shape = `
                <circle cx="${m}" cy="${size*0.35}" r="${size*0.18}" fill="url(#fill-${house})" opacity="0.8"/>
                <path d="M ${size*0.2} ${size*0.6} Q ${size*0.35} ${size*0.52} ${m} ${size*0.6} Q ${size*0.65} ${size*0.68} ${size*0.8} ${size*0.6}" fill="none" stroke="${c.colorLight}" stroke-width="1.5" opacity="0.6"/>
                <path d="M ${size*0.15} ${size*0.68} Q ${size*0.35} ${size*0.6} ${m} ${size*0.68} Q ${size*0.65} ${size*0.76} ${size*0.85} ${size*0.68}" fill="none" stroke="${c.colorLight}" stroke-width="1" opacity="0.4"/>
            `;
        }

        return `
            <svg width="${size}" height="${size}" viewBox="0 0 ${size} ${size}">
                <defs>
                    <radialGradient id="glow-${house}" cx="50%" cy="50%" r="50%">
                        <stop offset="0%" stop-color="${c.colorLight}" stop-opacity="0.6"/>
                        <stop offset="100%" stop-color="${c.colorDark}" stop-opacity="0"/>
                    </radialGradient>
                    <linearGradient id="fill-${house}" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" stop-color="${c.colorLight}"/>
                        <stop offset="100%" stop-color="${c.colorDark}"/>
                    </linearGradient>
                </defs>
                <circle cx="${m}" cy="${m}" r="${m*0.8}" fill="url(#glow-${house})"/>
                ${shape}
            </svg>
        `;
    }

    // ‚îÄ‚îÄ Format Value ‚îÄ‚îÄ
    function formatValue(kpi, value) {
        if (value === 0 || value === null || value === undefined) return '‚Äî';
        if (kpi.unit === '%') return value.toFixed(1) + '%';
        if (kpi.unit === '/10') return value.toFixed(1);
        if (kpi.unit === ' pts') return '+' + value.toFixed(1);
        return value.toFixed(1);
    }

    // ‚îÄ‚îÄ Get best house for a KPI ‚îÄ‚îÄ
    function getBest(kpiKey) {
        const kpis = appData.periods[currentPeriod].kpis[kpiKey];
        let best = null, bestVal = -Infinity;
        HOUSE_ORDER.forEach(h => {
            if ((kpis[h] || 0) > bestVal) { bestVal = kpis[h] || 0; best = h; }
        });
        // Only mark best if value > 0
        return bestVal > 0 ? best : null;
    }

    // ‚îÄ‚îÄ Get max value for bar scaling ‚îÄ‚îÄ
    function getMax(kpiKey) {
        const config = KPI_CONFIG.find(k => k.key === kpiKey);
        if (config.maxValue) return config.maxValue;
        const kpis = appData.periods[currentPeriod].kpis[kpiKey];
        const vals = HOUSE_ORDER.map(h => kpis[h] || 0);
        const m = Math.max(...vals);
        return m > 0 ? m * 1.15 : 10;
    }

    // ‚îÄ‚îÄ Render Period Toggle ‚îÄ‚îÄ
    function renderPeriodToggle() {
        const el = document.getElementById('periodToggle');
        const periods = appData.periods;
        el.innerHTML = `
            <button class="period-btn body-font ${currentPeriod === 'current' ? 'active' : ''}" data-period="current">
                ${periods.current.label}
            </button>
            <button class="period-btn body-font ${currentPeriod === 'accumulated' ? 'active' : ''}" data-period="accumulated">
                ${periods.accumulated.label}
            </button>
        `;
        el.querySelectorAll('.period-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                currentPeriod = btn.dataset.period;
                renderPeriodToggle();
                renderKPIs();
            });
        });
    }

    // ‚îÄ‚îÄ Render House Cards ‚îÄ‚îÄ
    function renderHouseCards() {
        const el = document.getElementById('housesGrid');
        el.innerHTML = HOUSE_ORDER.map(key => {
            const house = appData.houses[key];
            const c = HOUSES[key];
            return `
                <div class="house-card" style="--card-gradient:${c.gradient};--card-glow:${c.glow};">
                    <div class="glow-bg" style="background:radial-gradient(circle,${c.glow},transparent 70%);"></div>
                    <div class="inner">
                        <div class="house-emblem">${houseEmblem(key)}</div>
                        <h2 class="house-name" style="color:${c.colorLight};">${house.name}</h2>
                        <p class="house-sensibility body-font">${house.sensibility}</p>
                        <p class="house-motto">"${house.motto}"</p>
                        <div class="house-stats">
                            <div>
                                <div class="house-stat-value body-font" style="color:${c.colorLight};">${house.therapists_count}</div>
                                <div class="house-stat-label body-font">terapeutas</div>
                            </div>
                            <div class="house-stats-divider"></div>
                            <div>
                                <div class="house-stat-value body-font" style="color:${c.colorLight};">${house.active_patients}</div>
                                <div class="house-stat-label body-font">pacientes</div>
                            </div>
                        </div>
                        <div class="house-leader body-font">L√≠der: <span style="color:${c.colorLight};">${house.leader}</span></div>
                    </div>
                </div>
            `;
        }).join('');
    }

    // ‚îÄ‚îÄ Render KPI Sections ‚îÄ‚îÄ
    function renderKPIs() {
        const el = document.getElementById('kpiList');
        const periodData = appData.periods[currentPeriod];

        el.innerHTML = KPI_CONFIG.map((kpi, kpiIdx) => {
            const maxVal = getMax(kpi.key);
            const best = getBest(kpi.key);

            const barsHTML = HOUSE_ORDER.map((houseKey, hIdx) => {
                const value = periodData.kpis[kpi.key][houseKey] || 0;
                const c = HOUSES[houseKey];
                const isBest = houseKey === best;
                const pct = maxVal > 0 ? Math.min((value / maxVal) * 100, 100) : 0;

                return `
                    <div class="bar-row">
                        <div class="bar-row-header body-font">
                            <div class="bar-label">
                                <div class="bar-dot" style="background:${c.color};box-shadow:0 0 8px ${c.glow};"></div>
                                <span class="bar-name" style="color:${isBest ? c.colorLight : 'rgba(255,255,255,0.6)'};">
                                    ${appData.houses[houseKey].name}
                                </span>
                                ${isBest ? `<span class="best-tag" style="background:${c.color}20;color:${c.colorLight};border:1px solid ${c.color}40;">‚òÖ melhor</span>` : ''}
                            </div>
                            <span class="bar-value" style="color:${isBest ? c.colorLight : 'rgba(255,255,255,0.7)'};">
                                ${formatValue(kpi, value)}
                            </span>
                        </div>
                        <div class="bar-track">
                            <div class="bar-fill" 
                                 data-width="${pct}"
                                 style="background:${c.gradient};box-shadow:0 0 20px ${c.color}40, inset 0 1px 0 rgba(255,255,255,0.2);transition-delay:${hIdx * 0.15 + kpiIdx * 0.08}s;">
                                <div class="shine"></div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            return `
                <div class="kpi-section" style="animation:fadeInUp 0.8s cubic-bezier(0.22,1,0.36,1) ${0.3 + kpiIdx * 0.1}s both;">
                    <div class="kpi-header">
                        <div>
                            <div class="kpi-title-row">
                                <span class="kpi-icon">${kpi.icon}</span>
                                <h3 class="kpi-title">${kpi.label}</h3>
                            </div>
                            <p class="kpi-subtitle body-font">
                                ${kpi.subtitle}
                                <span class="tooltip body-font">${kpi.desc}</span>
                            </p>
                        </div>
                    </div>
                    <div class="kpi-bars">${barsHTML}</div>
                </div>
            `;
        }).join('');

        // Animate bars after a tick
        requestAnimationFrame(() => {
            requestAnimationFrame(() => {
                document.querySelectorAll('.bar-fill').forEach(bar => {
                    bar.style.width = bar.dataset.width + '%';
                });
            });
        });
    }

    // ‚îÄ‚îÄ Render Footer ‚îÄ‚îÄ
    function renderFooter() {
        const el = document.getElementById('footer');
        const d = new Date(appData.updated_at);
        const formatted = d.toLocaleString('pt-BR', {
            day: '2-digit', month: 'long', year: 'numeric',
            hour: '2-digit', minute: '2-digit'
        });
        el.innerHTML = `
            √öltima atualiza√ß√£o: ${formatted}<br/>
            Dados extra√≠dos do Hamilton ¬∑ Associa√ß√£o Allos<br/>
            <span class="allos-slogan">Transformando talentos em legado</span>
        `;
    }

    // ‚îÄ‚îÄ Load Data ‚îÄ‚îÄ
    async function loadData() {
        try {
            const response = await fetch('data.json?' + Date.now());
            if (!response.ok) throw new Error('Arquivo data.json n√£o encontrado');
            appData = await response.json();

            document.getElementById('loading').style.display = 'none';
            document.getElementById('content').style.display = 'block';

            renderPeriodToggle();
            renderHouseCards();
            renderKPIs();
            renderFooter();
        } catch (err) {
            console.error('Erro ao carregar dados:', err);
            document.getElementById('loading').innerHTML = `
                <div class="error-box">
                    <h2>Dados n√£o encontrados</h2>
                    <p class="body-font">
                        O arquivo <code>data.json</code> ainda n√£o foi gerado.<br/>
                        Execute <code>python generate_data.py</code> para gerar os dados.
                    </p>
                </div>
            `;
        }
    }

    // ‚îÄ‚îÄ Init ‚îÄ‚îÄ
    createParticles();
    loadData();
    </script>
</body>
</html>
